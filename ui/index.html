<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      http-equiv="Content-Security-Policy"
      content="default-src 'self'; base-uri 'self'; object-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'none'"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VibeFlow</title>
    <link rel="stylesheet" href="../node_modules/@fortawesome/fontawesome-free/css/all.min.css" />
    <link rel="stylesheet" href="./dist/renderer.css" />
    <style>
      :root {
        --app-bg: #09090b;
        --app-panel: #0c0c0e;
        --app-border: rgba(255, 255, 255, 0.06);
        --app-active: #18181b;
        --app-accent: #3b82f6;
        --app-text: #e4e4e7;
        --app-dim: #71717a;
      }

      * {
        box-sizing: border-box;
      }

      ::-webkit-scrollbar {
        width: 6px;
      }

      ::-webkit-scrollbar-track {
        background: transparent;
      }

      ::-webkit-scrollbar-thumb {
        background: #333;
        border-radius: 3px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #444;
      }

      html,
      body {
        margin: 0;
        padding: 0;
      }

      body {
        background-color: #000;
        color: var(--app-text);
        height: 100vh;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        user-select: none;
        font-family: "Inter", "Segoe UI", sans-serif;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox=%220 0 200 200%22 xmlns=%22http://www.w3.org/2000/svg%22%3E%3Cfilter id=%22noiseFilter%22%3E%3CfeTurbulence type=%22fractalNoise%22 baseFrequency=%220.65%22 numOctaves=%223%22 stitchTiles=%22stitch%22/%3E%3C/filter%3E%3Crect width=%22100%25%22 height=%22100%25%22 filter=%22url(%23noiseFilter)%22 opacity=%220.04%22/%3E%3C/svg%3E");
        opacity: 0.04;
        pointer-events: none;
      }

      .title-bar {
        height: 42px;
        background: var(--app-bg);
        border-bottom: 1px solid var(--app-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-left: 12px;
        -webkit-app-region: drag;
      }

      .no-drag {
        -webkit-app-region: no-drag;
      }

      .title-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 1;
        overflow: hidden;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-right: 12px;
        opacity: 0.85;
        transition: opacity 0.2s;
      }

      .brand:hover {
        opacity: 1;
      }

      .brand-icon {
        width: 20px;
        height: 20px;
        background: transparent;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        box-shadow: 0 0 20px -5px rgba(59, 130, 246, 0.15);
      }

      .brand-icon img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
      }

      .brand-text {
        font-size: 11px;
        font-weight: 700;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: #d4d4d8;
      }

      .tab-container {
        display: flex;
        align-items: center;
        gap: 8px;
        overflow-x: auto;
        scrollbar-width: none;
      }

      .tab-container::-webkit-scrollbar {
        display: none;
      }

      .tab {
        height: 30px;
        padding: 0 12px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        font-weight: 500;
        color: var(--app-dim);
        cursor: pointer;
        transition: all 0.2s;
        border: 1px solid transparent;
        min-width: 140px;
        background: transparent;
      }

      .tab:hover {
        background: rgba(255, 255, 255, 0.03);
        color: #a1a1aa;
      }

      .tab.active {
        background: var(--app-active);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
      }

      .tab.dragging {
        opacity: 0.5;
        border: 1px dashed rgba(255, 255, 255, 0.2);
      }

      .tab.drag-over {
        border-left: 2px solid rgba(59, 130, 246, 0.75);
        box-shadow: inset 4px 0 0 rgba(59, 130, 246, 0.25);
      }

      .tab.placeholder {
        color: #666;
        cursor: pointer;
      }

      .tab .tab-title {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
      }

      .tab .tab-close {
        color: #666;
        padding: 2px;
        border-radius: 4px;
      }

      .tab .tab-close:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.05);
      }

      .tab.is-colored {
        border: 1px solid color-mix(in srgb, var(--tab-accent, #3b82f6) 50%, transparent);
        background: color-mix(in srgb, var(--tab-accent, #3b82f6) 16%, transparent);
        color: #f5f5f5;
      }

      .tab.is-colored:hover {
        background: color-mix(in srgb, var(--tab-accent, #3b82f6) 22%, transparent);
      }

      .tab .tab-activity {
        font-size: 10px;
        color: #60a5fa;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .tab .tab-activity.is-active {
        opacity: 1;
        animation: tab-spin 1s linear infinite;
      }

      .tab-add {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        background: transparent;
        border: 1px solid transparent;
        color: #777;
        cursor: pointer;
        transition: all 0.2s;
      }

      .tab-add:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.05);
      }

      @keyframes tab-spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      .tab-color-menu {
        position: fixed;
        z-index: 80;
        background: rgba(10, 10, 12, 0.98);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.45);
        border-radius: 10px;
        padding: 10px;
        min-width: 160px;
        display: none;
        gap: 10px;
        flex-direction: column;
      }

      .tab-color-menu.is-open {
        display: flex;
      }

      .tab-color-title {
        font-size: 11px;
        color: #9ca3af;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .tab-color-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
      }

      .tab-color-swatch {
        width: 36px;
        height: 22px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        cursor: pointer;
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      .tab-color-swatch:hover {
        transform: translateY(-1px) scale(1.02);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.35);
      }

      .tab-color-clear {
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: #cbd5f5;
        border-radius: 8px;
        font-size: 11px;
        padding: 6px 8px;
        cursor: pointer;
        text-align: center;
      }

      .tab-color-clear:hover {
        background: rgba(255, 255, 255, 0.08);
      }

      .terminal-attach {
        height: 34px;
        padding: 0 12px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.02);
        color: #9ca3af;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 11px;
        letter-spacing: 0.02em;
      }

      .terminal-attach:hover {
        color: #facc15;
        border-color: rgba(250, 204, 21, 0.4);
        background: rgba(250, 204, 21, 0.08);
      }

      .title-controls {
        display: flex;
        height: 100%;
        align-items: center;
      }

      .title-action {
        width: 36px;
        height: 28px;
        margin-right: 6px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(255, 255, 255, 0.02);
        color: #9ca3af;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .title-action:hover {
        color: #fff;
        border-color: rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.05);
      }

      .win-btn {
        width: 46px;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #999;
        cursor: pointer;
        transition: background 0.15s;
        border: none;
        background: transparent;
      }

      .win-btn:hover {
        background: rgba(255, 255, 255, 0.05);
        color: #fff;
      }

      .win-btn.close:hover {
        background: #c42b1c;
      }

      .workspace {
        flex: 1;
        display: flex;
        overflow: hidden;
        background: #050505;
      }

      .tool-panel {
        width: 260px;
        margin: 6px 0 6px 6px;
        background: #0b0b0d;
        border: 1px solid var(--app-border);
        border-radius: 8px;
        display: none;
        flex-direction: column;
        overflow: hidden;
        transition: width 0.2s ease;
      }

      .tool-panel.collapsed {
        width: 42px;
      }

      .tool-panel.collapsed .tool-tree,
      .tool-panel.collapsed .tool-viewer {
        display: none;
      }

      .tool-panel.collapsed .tool-header span {
        display: none;
      }

      .tool-panel.collapsed .tool-action.refresh {
        display: none;
      }

      .tool-panel.collapsed .tool-header {
        justify-content: center;
        padding: 0;
      }

      .tool-header {
        height: 40px;
        padding: 0 14px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
        background: #0e0e10;
        font-size: 11px;
        letter-spacing: 0.14em;
        text-transform: uppercase;
        color: #94a3b8;
      }

      .tool-action {
        border: none;
        background: transparent;
        color: #64748b;
        cursor: pointer;
      }

      .tool-action:hover {
        color: #fff;
      }

      .tool-action.secondary {
        font-size: 12px;
      }

      .tool-tree {
        flex: 1;
        overflow-y: auto;
        padding: 10px 0;
      }

      .tool-node {
        display: grid;
        gap: 4px;
      }

      .tool-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        font-size: 12px;
        color: #cbd5f5;
        cursor: pointer;
        user-select: none;
      }

      .tool-item:hover {
        background: rgba(255, 255, 255, 0.04);
      }

      .tool-item.active {
        background: rgba(34, 197, 94, 0.12);
        outline: 1px solid rgba(34, 197, 94, 0.5);
        color: #e2e8f0;
      }

      .tool-item.file.is-read {
        box-shadow: inset 2px 0 0 #facc15;
        color: #fef08a;
      }

      .tool-item.file.is-write {
        box-shadow: inset 2px 0 0 #f87171;
        color: #fecaca;
      }

      .tool-item.active.is-read,
      .tool-item.active.is-write {
        background: rgba(34, 197, 94, 0.12);
        outline: 1px solid rgba(34, 197, 94, 0.5);
        color: #e2e8f0;
        box-shadow: none;
      }

      .tool-item .icon {
        width: 14px;
        display: inline-flex;
        justify-content: center;
        color: #94a3b8;
      }

      .tool-item.file .icon {
        color: #60a5fa;
      }

      .tool-children {
        display: grid;
        gap: 2px;
      }

      .tool-children.collapsed {
        display: none;
      }

      .tool-viewer {
        border-top: 1px solid rgba(255, 255, 255, 0.06);
        background: #0f1013;
        padding: 10px 12px;
        display: grid;
        gap: 8px;
        min-height: 140px;
        max-height: 220px;
      }

      .tool-path {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #94a3b8;
      }

      .tool-content {
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
        font-size: 11px;
        color: #e5e7eb;
        white-space: pre-wrap;
        word-break: break-word;
        overflow-y: auto;
        max-height: 160px;
      }

      .terminal-container {
        flex: 1;
        margin: 6px;
        background: #0a0a0a;
        border: 1px solid var(--app-border);
        border-radius: 8px;
        position: relative;
        overflow: hidden;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.5);
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }

      .terminal-scrollbar {
        position: absolute;
        top: 10px;
        right: 6px;
        bottom: 10px;
        width: 10px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.04);
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 2px 0;
        z-index: 14;
      }

      .terminal-scrollbar-thumb {
        width: 6px;
        border-radius: 999px;
        background: rgba(148, 163, 184, 0.7);
        box-shadow: 0 0 6px rgba(59, 130, 246, 0.35);
        cursor: pointer;
      }

      .intent-quick {
        position: absolute;
        right: 18px;
        bottom: 16px;
        z-index: 12;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 10px;
        background: rgba(18, 18, 20, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: #e5e7eb;
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
      }

      .intent-actions {
        position: absolute;
        right: 18px;
        bottom: 16px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        z-index: 12;
      }

      .intent-actions .intent-quick {
        position: static;
      }

      .terminal-jump {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 10px;
        border-radius: 10px;
        background: rgba(18, 18, 20, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.08);
        color: #e5e7eb;
        font-size: 11px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
        cursor: pointer;
      }

      .terminal-jump:hover {
        border-color: rgba(59, 130, 246, 0.5);
        color: #fff;
      }

      .intent-quick:hover {
        border-color: rgba(59, 130, 246, 0.5);
        color: #fff;
      }

      .panel-pane {
        padding: 24px 28px;
        height: 100%;
        overflow-y: auto;
      }

      .panel-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 18px;
      }

      .panel-title {
        font-size: 20px;
        font-weight: 700;
        color: #f9fafb;
      }

      .panel-subtitle {
        font-size: 12px;
        color: #94a3b8;
        margin-top: 4px;
      }

      .panel-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 18px;
      }

      .panel-card {
        background: #0f1013;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 16px;
        display: grid;
        gap: 10px;
        align-content: start;
      }

      .panel-card h3 {
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #94a3b8;
        margin: 0 0 6px;
      }

      .settings-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        font-size: 13px;
        color: #e5e7eb;
      }

      .settings-hint {
        font-size: 12px;
        color: #9ca3af;
      }

      .settings-list {
        display: grid;
        gap: 8px;
        font-size: 12px;
        color: #e5e7eb;
      }

      .settings-command {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .settings-command-text {
        display: grid;
        gap: 2px;
      }

      .settings-command-title {
        font-weight: 600;
        color: #f8fafc;
      }

      .settings-command-hint {
        font-size: 10px;
        color: #9ca3af;
      }

      .settings-field {
        display: grid;
        gap: 8px;
        font-size: 12px;
        color: #e5e7eb;
      }

      .settings-field label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: #94a3b8;
      }

      .settings-select {
        width: 100%;
        padding: 8px 10px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: #0e0e12;
        color: #e5e7eb;
        font-size: 12px;
      }

      .settings-select:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .settings-about {
        display: grid;
        gap: 12px;
        font-size: 12px;
        color: #e5e7eb;
      }

      .about-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
      }

      .about-meta {
        display: grid;
        gap: 4px;
      }

      .about-title {
        font-weight: 600;
        color: #f8fafc;
      }

      .about-sub {
        font-size: 11px;
        color: #94a3b8;
      }

      .about-link {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        color: #e5e7eb;
        font-size: 11px;
        cursor: pointer;
      }

      .about-link:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .settings-danger {
        border: 1px solid rgba(248, 113, 113, 0.2);
        background: rgba(127, 29, 29, 0.12);
      }

      .danger-button {
        padding: 8px 12px;
        border-radius: 8px;
        border: 1px solid rgba(248, 113, 113, 0.4);
        background: rgba(248, 113, 113, 0.15);
        color: #fecaca;
        font-size: 11px;
        font-weight: 600;
        cursor: pointer;
      }

      .danger-button:hover {
        background: rgba(248, 113, 113, 0.25);
        color: #fff;
      }

      .settings-command kbd {
        padding: 4px 8px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        font-size: 10px;
        color: #e5e7eb;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .toggle {
        position: relative;
        width: 44px;
        height: 24px;
        display: inline-flex;
        align-items: center;
      }

      .toggle input {
        display: none;
      }

      .toggle-track {
        width: 44px;
        height: 24px;
        border-radius: 999px;
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        position: relative;
        transition: background 0.2s ease;
      }

      .toggle-thumb {
        width: 18px;
        height: 18px;
        background: #fff;
        border-radius: 999px;
        position: absolute;
        top: 2px;
        left: 2px;
        transition: transform 0.2s ease;
      }

      .toggle input:checked + .toggle-track {
        background: rgba(59, 130, 246, 0.35);
      }

      .toggle input:checked + .toggle-track .toggle-thumb {
        transform: translateX(20px);
      }

      .history-list {
        display: grid;
        gap: 10px;
        margin: 0;
      }

      .history-item {
        background: #0c0c0e;
        border: 1px solid rgba(255, 255, 255, 0.06);
        border-radius: 10px;
        padding: 12px 14px;
        display: grid;
        gap: 6px;
      }

      .history-item.selectable {
        cursor: pointer;
        transition: border-color 0.2s ease, background 0.2s ease;
      }

      .history-item.selectable:hover {
        border-color: rgba(59, 130, 246, 0.4);
        background: rgba(255, 255, 255, 0.02);
      }

      .history-item.selected {
        border-color: rgba(59, 130, 246, 0.7);
        background: rgba(37, 99, 235, 0.08);
      }

      .history-item-title {
        font-size: 13px;
        font-weight: 600;
        color: #f8fafc;
      }

      .history-item-meta {
        font-size: 11px;
        color: #94a3b8;
      }

      .history-actions {
        display: flex;
        justify-content: flex-end;
        gap: 8px;
      }

      .history-actions button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: #121214;
        color: #e5e7eb;
        font-size: 11px;
        cursor: pointer;
      }

      .history-actions button.primary {
        background: #2563eb;
        border-color: transparent;
        color: #fff;
      }

      .history-layout {
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 18px;
        align-items: start;
      }

      .history-details-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: #94a3b8;
      }

      .history-details-row {
        display: grid;
        gap: 6px;
      }

      .history-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .history-diff-files {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .history-tag {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        font-size: 10px;
        color: #e5e7eb;
      }

      .history-diff-chip {
        padding: 4px 8px;
        border-radius: 999px;
        background: #151922;
        border: 1px solid rgba(59, 130, 246, 0.15);
        color: #cbd5f5;
        font-size: 10px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .history-empty {
        font-size: 12px;
        color: #94a3b8;
      }

      .history-details-inline {
        margin-top: 10px;
        padding: 12px 14px;
        border-radius: 10px;
        background: #101115;
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: grid;
        gap: 10px;
      }

      .history-details-inline .history-details-body {
        display: grid;
        gap: 12px;
        color: #e5e7eb;
        font-size: 12px;
      }

      .history-details-close {
        display: flex;
        justify-content: flex-end;
      }

      .history-details-close button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: #121214;
        color: #e5e7eb;
        font-size: 11px;
        cursor: pointer;
      }

      .terminal-container.flash-success {
        border-color: rgba(34, 197, 94, 0.9);
        box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4),
          inset 0 0 18px rgba(16, 185, 129, 0.3);
      }

      .terminal-container.flash-error {
        border-color: rgba(248, 113, 113, 0.9);
        box-shadow: 0 0 0 1px rgba(248, 113, 113, 0.4),
          inset 0 0 18px rgba(239, 68, 68, 0.3);
      }

      #terminal-stack {
        position: absolute;
        inset: 18px 20px 24px;
      }

      .terminal-pane {
        position: absolute;
        inset: 0;
        display: none;
      }

      .terminal-pane.active {
        display: block;
      }

      .terminal-pane .xterm {
        height: 100%;
        padding: 0;
      }

      .terminal-pane .xterm-viewport {
        overflow-y: scroll !important;
        scrollbar-gutter: stable;
        scrollbar-width: none;
      }

      .terminal-pane .xterm-viewport::-webkit-scrollbar {
        width: 0;
      }

      .terminal-pane .xterm-viewport::-webkit-scrollbar-thumb {
        background: transparent;
      }

      .context-panel {
        width: 320px;
        background: var(--app-panel);
        border-left: 1px solid var(--app-border);
        display: flex;
        flex-direction: column;
        transition: width 0.3s cubic-bezier(0.2, 0, 0, 1);
      }

      .context-panel.collapsed {
        width: 48px;
      }

      .context-panel.collapsed .context-actions {
        gap: 0;
      }

      .context-panel.collapsed #vf-action-echo {
        display: none;
      }

      .context-panel.collapsed .panel-content,
      .context-panel.collapsed .title-container {
        display: none;
      }

      .context-panel.collapsed .vertical-label {
        display: flex;
      }

      .context-panel.collapsed .context-echoes {
        display: none;
      }

      .context-header {
        height: 40px;
        border-bottom: 1px solid var(--app-border);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 16px;
        background: #0e0e10;
      }

      .context-actions {
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .title-container {
        display: flex;
        align-items: center;
        gap: 8px;
        overflow: hidden;
      }

      .status-dot {
        width: 6px;
        height: 6px;
        border-radius: 999px;
        background: #22c55e;
        box-shadow: 0 0 8px rgba(34, 197, 94, 0.6);
      }

      .context-title {
        font-size: 10px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: #9ca3af;
      }

      .context-toggle {
        border: none;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
      }

      .context-toggle:hover {
        color: #fff;
      }

      .panel-content {
        padding: 18px 20px;
      }

      .intent-group {
        margin-bottom: 22px;
      }

      .intent-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .intent-label {
        font-size: 12px;
        font-weight: 500;
        color: #60a5fa;
      }

      .intent-body {
        padding: 12px;
        background: #151518;
        border: 1px solid rgba(59, 130, 246, 0.15);
        border-radius: 8px;
        font-size: 12px;
        color: #e5e7eb;
        line-height: 1.5;
        position: relative;
      }

      .intent-body::before {
        content: "";
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 2px;
        background: var(--app-accent);
      }

      .flow-card {
        margin-bottom: 24px;
      }

      .flow-label {
        font-size: 12px;
        font-weight: 500;
        color: #9ca3af;
        margin-bottom: 8px;
        display: block;
      }

      .flow-row {
        display: flex;
        align-items: baseline;
        gap: 8px;
        margin-bottom: 6px;
      }

      .flow-time {
        font-size: 22px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
        font-weight: 700;
        color: #fff;
      }

      .flow-state {
        font-size: 10px;
        color: #4ade80;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .flow-bar {
        width: 100%;
        height: 4px;
        background: #1a1a1c;
        border-radius: 999px;
        overflow: hidden;
      }

      .flow-bar-fill {
        height: 100%;
        background: linear-gradient(90deg, rgba(59, 130, 246, 0.8), rgba(99, 102, 241, 0.95), rgba(59, 130, 246, 0.8));
        background-size: 200% 100%;
        width: 40%;
        box-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
        animation: flowPulse 4s ease-in-out infinite;
        opacity: 0.75;
      }

      @keyframes flowPulse {
        0% {
          background-position: 0% 50%;
          opacity: 0.55;
        }
        50% {
          background-position: 100% 50%;
          opacity: 0.95;
        }
        100% {
          background-position: 0% 50%;
          opacity: 0.6;
        }
      }

      .thoughts-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .thoughts-label {
        font-size: 12px;
        font-weight: 500;
        color: #9ca3af;
      }

      .thoughts-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 8px;
      }

      .thoughts-list li {
        display: flex;
        gap: 8px;
        padding: 8px;
        border-radius: 8px;
        border: 1px solid transparent;
        color: #9ca3af;
        font-size: 12px;
        align-items: center;
      }

      .thoughts-list li:hover {
        background: #1a1a1c;
        border-color: rgba(255, 255, 255, 0.05);
        color: #d1d5db;
      }

      .thoughts-delete {
        margin-left: auto;
        border: none;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
        font-size: 12px;
        padding: 4px;
      }

      .thoughts-delete:hover {
        color: #f87171;
      }

      .context-echoes {
        margin: 8px 16px 16px;
        padding: 12px;
        border-radius: 12px;
        border: 1px solid rgba(59, 130, 246, 0.18);
        background: linear-gradient(135deg, rgba(19, 24, 36, 0.9), rgba(13, 16, 22, 0.95));
        box-shadow: 0 10px 24px rgba(15, 23, 42, 0.4);
        display: none;
        gap: 8px;
      }

      .context-echoes-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.18em;
        color: #93c5fd;
      }

      .echo-list {
        display: grid;
        gap: 10px;
      }

      .echo-item {
        display: grid;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 10px;
        background: rgba(14, 18, 26, 0.95);
        border: 1px solid rgba(59, 130, 246, 0.2);
        color: #e5e7eb;
      }

      .echo-text {
        font-size: 12px;
        color: #e5e7eb;
        line-height: 1.4;
      }

      .echo-actions {
        display: flex;
        gap: 6px;
      }

      .echo-action {
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: rgba(255, 255, 255, 0.04);
        color: #cbd5f5;
        font-size: 10px;
        cursor: pointer;
      }

      .echo-action.primary {
        border-color: rgba(34, 197, 94, 0.35);
        color: #86efac;
      }

      .echo-action.danger {
        border-color: rgba(248, 113, 113, 0.35);
        color: #fca5a5;
      }

      .echo-enter {
        animation: echoSlideIn 0.6s cubic-bezier(0.2, 0.7, 0.1, 1.2) both;
      }

      @keyframes echoSlideIn {
        0% {
          opacity: 0;
          transform: translateX(40px);
        }
        70% {
          opacity: 1;
          transform: translateX(-6px);
        }
        100% {
          transform: translateX(0);
        }
      }

      .thought-skeleton {
        display: grid;
        grid-template-columns: 8px 1fr;
        gap: 8px;
        align-items: center;
        padding: 8px;
        border-radius: 8px;
        background: rgba(24, 24, 27, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.06);
        animation: skeletonPulse 0.75s ease-out;
      }

      .skeleton-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: rgba(59, 130, 246, 0.6);
        box-shadow: 0 0 8px rgba(59, 130, 246, 0.35);
      }

      .skeleton-bar {
        height: 8px;
        border-radius: 999px;
        background: linear-gradient(90deg, rgba(255, 255, 255, 0.06), rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.06));
        background-size: 200% 100%;
        animation: shimmer 0.9s ease-in-out;
      }

      @keyframes shimmer {
        0% {
          background-position: 0% 50%;
        }
        100% {
          background-position: 100% 50%;
        }
      }

      @keyframes skeletonPulse {
        0% {
          transform: scale(0.98);
          opacity: 0.7;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .context-footer {
        border-top: 1px solid var(--app-border);
      }

      .context-footer button {
        width: 100%;
        padding: 10px;
        background: #1a1a1c;
        border: 1px solid var(--app-border);
        font-size: 12px;
        color: #d1d5db;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .context-footer button:hover {
        background: #222;
      }

      .vertical-label {
        display: none;
        height: 100%;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding-top: 24px;
        gap: 12px;
      }

      .vertical-label span {
        font-size: 10px;
        font-weight: 700;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        writing-mode: vertical-rl;
        transform: rotate(180deg);
      }

      .command-dock {
        height: 140px;
        background: var(--app-bg);
        border-top: 1px solid var(--app-border);
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 20;
        transition: height 0.2s ease;
      }

      .command-dock.collapsed {
        height: 32px;
      }

      .command-dock.collapsed .command-log,
      .command-dock.collapsed .command-input {
        display: none;
      }

      .command-dock.collapsed .command-collapsed {
        display: flex;
      }

      .command-log {
        flex: 1;
        overflow-y: auto;
        padding: 16px 24px;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        gap: 8px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .command-entry {
        display: flex;
        align-items: center;
        gap: 12px;
        opacity: 0.6;
        transition: opacity 0.2s;
      }

      .command-entry:hover {
        opacity: 1;
      }

      .command-time {
        width: 40px;
        font-size: 10px;
        color: #6b7280;
        text-align: right;
      }

      .command-text {
        font-size: 12px;
        color: #d1d5db;
      }

      .command-input {
        padding: 8px 24px 16px;
      }

      .cmd-input-wrapper {
        background: #121214;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 8px;
        display: flex;
        align-items: center;
        transition: border-color 0.2s, box-shadow 0.2s;
        padding: 4px;
      }

      .cmd-input-wrapper:focus-within {
        border-color: var(--app-accent);
        box-shadow: 0 0 0 1px var(--app-accent), 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .cmd-prompt {
        padding-left: 8px;
        padding-right: 8px;
        color: #22c55e;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
        font-weight: 700;
        font-size: 12px;
      }

      #vf-chat-text {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        color: #fff;
        font-size: 13px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
        padding: 8px 10px;
      }

      #vf-chat-text::placeholder {
        color: #6b7280;
      }

      #vf-chat-text:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      .cmd-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        padding-right: 6px;
      }

      .cmd-agent {
        border: none;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
      }

      .cmd-agent:hover {
        color: #60a5fa;
        background: rgba(255, 255, 255, 0.08);
      }

      .cmd-agent[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .cmd-attach {
        border: none;
        background: transparent;
        color: #6b7280;
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
      }

      .cmd-attach:hover {
        color: #facc15;
        background: rgba(255, 255, 255, 0.08);
      }

      .cmd-attach[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .cmd-attach .attach-terminal-icon {
        font-size: 9px;
        color: #94a3b8;
        position: absolute;
        right: 2px;
        bottom: 2px;
        opacity: 0.8;
        pointer-events: none;
      }

      .cmd-divider {
        width: 1px;
        height: 16px;
        background: rgba(255, 255, 255, 0.1);
      }

      #vf-chat-send {
        border: none;
        background: transparent;
        color: #9ca3af;
        cursor: pointer;
        padding: 4px;
        border-radius: 6px;
      }

      #vf-chat-send:hover {
        color: #fff;
        background: rgba(255, 255, 255, 0.08);
      }

      #vf-chat-send[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .command-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 8px;
        font-size: 10px;
        color: #6b7280;
      }

      .command-hints {
        display: flex;
        gap: 12px;
      }

      .command-toggle {
        border: none;
        background: transparent;
        color: #9ca3af;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        font-size: 10px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .command-toggle:hover {
        color: #fff;
      }

      .command-collapsed {
        height: 32px;
        display: none;
        align-items: center;
        justify-content: space-between;
        padding: 0 16px;
        font-size: 11px;
        color: #9ca3af;
      }

      .voice-overlay {
        position: fixed;
        left: 50%;
        bottom: 120px;
        transform: translateX(-50%);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 70;
        pointer-events: none;
      }

      .voice-overlay.is-open {
        display: flex;
      }

      .voice-overlay.is-processing .voice-pill {
        border-color: rgba(245, 158, 11, 0.45);
        background: rgba(20, 14, 8, 0.92);
      }

      .voice-overlay.is-processing .voice-bars span {
        background: linear-gradient(180deg, #fcd34d, #f59e0b);
        animation: voicePulse 1.6s ease-in-out infinite;
      }

      .voice-overlay.is-processing .voice-text {
        color: #fde68a;
      }

      .voice-pill {
        padding: 10px 16px;
        border-radius: 999px;
        border: 1px solid rgba(59, 130, 246, 0.3);
        background: rgba(12, 15, 22, 0.9);
        box-shadow: 0 18px 45px rgba(10, 10, 20, 0.45);
        display: flex;
        align-items: center;
        gap: 12px;
        color: #e2e8f0;
        font-size: 12px;
        letter-spacing: 0.08em;
        text-transform: uppercase;
      }

      .voice-bars {
        display: flex;
        align-items: flex-end;
        gap: 4px;
      }

      .voice-bars span {
        width: 4px;
        height: 10px;
        border-radius: 999px;
        background: linear-gradient(180deg, #93c5fd, #60a5fa);
        animation: voiceWave 1.2s ease-in-out infinite;
      }

      .voice-bars span:nth-child(2) {
        animation-delay: 0.15s;
      }

      .voice-bars span:nth-child(3) {
        animation-delay: 0.3s;
      }

      .voice-bars span:nth-child(4) {
        animation-delay: 0.45s;
      }

      @keyframes voiceWave {
        0%,
        100% {
          height: 8px;
          opacity: 0.6;
        }
        50% {
          height: 18px;
          opacity: 1;
        }
      }

      @keyframes voicePulse {
        0%,
        100% {
          height: 6px;
          opacity: 0.55;
        }
        50% {
          height: 14px;
          opacity: 1;
        }
      }

      .voice-text {
        font-size: 11px;
        color: #cbd5f5;
        text-transform: none;
        letter-spacing: 0.02em;
        max-width: 260px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .overlay-backdrop {
        background: rgba(0, 0, 0, 0.75);
        backdrop-filter: blur(4px);
      }

      .popup {
        width: 500px;
        background: #0c0c0e;
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .popup-header {
        padding: 12px 16px;
        background: #121214;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .popup-header h3 {
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.2em;
        color: #9ca3af;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .popup-body {
        padding: 16px;
      }

      .popup-body input {
        width: 100%;
        background: transparent;
        border: none;
        outline: none;
        font-size: 18px;
        color: #fff;
        font-weight: 500;
      }

      .popup-footer {
        padding: 8px 16px;
        background: #121214;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 10px;
        color: #6b7280;
      }

      .confirm-message {
        font-size: 13px;
        color: #e5e7eb;
        line-height: 1.5;
      }

      .confirm-actions {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .ghost-button {
        padding: 6px 10px;
        border-radius: 6px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: transparent;
        color: #e5e7eb;
        font-size: 11px;
        cursor: pointer;
      }

      .resume-screen {
        position: fixed;
        inset: 0;
        z-index: 50;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 24px;
        background: radial-gradient(
            1200px 600px at 15% 10%,
            rgba(56, 189, 248, 0.08),
            transparent 60%
          ),
          radial-gradient(
            900px 520px at 90% 0%,
            rgba(99, 102, 241, 0.08),
            transparent 55%
          ),
          rgba(6, 8, 12, 0.82);
        backdrop-filter: blur(8px);
      }

      .resume-screen.is-open {
        display: flex;
      }

      .resume-card {
        width: min(960px, 92vw);
        padding: 28px 32px 26px;
        background: linear-gradient(180deg, #0c1118 0%, #0a0e14 100%);
        border: 1px solid rgba(148, 163, 184, 0.16);
        border-radius: 18px;
        position: relative;
        overflow: hidden;
        box-shadow: 0 18px 50px rgba(0, 0, 0, 0.45);
      }

      .resume-card::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        width: 240px;
        height: 240px;
        background: rgba(59, 130, 246, 0.08);
        border-radius: 50%;
        filter: blur(90px);
        transform: translate(40%, -40%);
      }

      .resume-header {
        text-align: left;
        margin-bottom: 22px;
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .resume-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-size: 11px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: #93c5fd;
        background: rgba(59, 130, 246, 0.12);
        border: 1px solid rgba(59, 130, 246, 0.25);
        padding: 4px 10px;
        border-radius: 999px;
        margin-bottom: 10px;
      }

      .resume-pill img {
        width: 14px;
        height: 14px;
        object-fit: contain;
        display: block;
      }

      .resume-title {
        font-size: 26px;
        font-weight: 700;
        color: #fff;
        margin: 0 0 4px;
      }

      .resume-sub {
        color: #94a3b8;
        font-size: 13px;
        line-height: 1.5;
      }

      .resume-repo {
        margin-top: 6px;
        font-size: 16px;
        font-weight: 600;
        color: #7dd3fc;
        text-shadow: 0 0 10px rgba(56, 189, 248, 0.35);
      }

      .resume-trace {
        margin-top: 8px;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 4px 10px;
        border-radius: 999px;
        border: 1px solid rgba(59, 130, 246, 0.3);
        background: rgba(59, 130, 246, 0.12);
        color: #93c5fd;
        font-size: 10px;
        letter-spacing: 0.14em;
        text-transform: uppercase;
      }

      .resume-grid {
        display: grid;
        grid-template-columns: minmax(220px, 1fr) minmax(320px, 2fr);
        gap: 14px;
        margin-bottom: 20px;
        position: relative;
        z-index: 1;
      }

      .resume-card-box {
        background: rgba(17, 24, 39, 0.65);
        border: 1px solid rgba(148, 163, 184, 0.16);
        border-radius: 12px;
        padding: 16px 18px;
      }

      .resume-label {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #9aa4b2;
        margin-bottom: 6px;
      }

      .resume-value {
        font-size: 20px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
        color: #f8fafc;
      }

      .resume-flow {
        font-size: 14px;
        color: #86efac;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .resume-intent {
        grid-column: 2;
        grid-row: 1 / span 2;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .resume-intent-text {
        font-size: 16px;
        color: #e2e8f0;
        line-height: 1.6;
      }

      .resume-next {
        padding-top: 12px;
        border-top: 1px solid rgba(148, 163, 184, 0.18);
        font-size: 13px;
        color: #cbd5f5;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .resume-actions {
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        position: relative;
        z-index: 1;
        padding-top: 14px;
        border-top: 1px solid rgba(148, 163, 184, 0.12);
      }

      .resume-actions button {
        padding: 10px 16px;
        background: rgba(15, 23, 42, 0.7);
        border: 1px solid rgba(148, 163, 184, 0.18);
        border-radius: 8px;
        color: #e2e8f0;
        font-size: 13px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .resume-actions button.primary {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
        color: #fff;
        border-color: transparent;
        box-shadow: 0 10px 26px rgba(37, 99, 235, 0.28);
      }

      .new-tab-screen {
        position: absolute;
        inset: 0;
        z-index: 10;
        background: #0a0a0a;
        display: none;
        align-items: center;
        justify-content: center;
      }

      .new-tab-screen.is-open {
        display: flex;
      }

      .new-tab-card {
        text-align: center;
        max-width: 360px;
      }

      .new-tab-card button {
        width: 220px;
        padding: 10px 14px;
        background: #121214;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 10px;
        color: #d1d5db;
        font-size: 13px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        cursor: pointer;
      }

      .new-tab-hint {
        margin-top: 16px;
        font-size: 10px;
        color: #52525b;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .recent-wrap {
        margin-top: 24px;
        text-align: left;
      }

      .recent-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: #6b7280;
        margin-bottom: 10px;
      }

      .recent-list {
        display: grid;
        gap: 8px;
      }

      .recent-item {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.06);
        background: #0f0f12;
        color: #e5e7eb;
        display: grid;
        gap: 4px;
        cursor: pointer;
        text-align: left;
        transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease;
      }

      .recent-item:hover {
        border-color: rgba(59, 130, 246, 0.4);
        background: rgba(255, 255, 255, 0.03);
        transform: translateY(-1px);
      }

      .recent-item-title {
        font-size: 12px;
        font-weight: 600;
      }

      .recent-item-intent {
        font-size: 11px;
        color: #a1a1aa;
      }

      .recent-item-meta {
        font-size: 10px;
        color: #6b7280;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .park-fly {
        position: fixed;
        z-index: 60;
        padding: 8px 12px;
        background: rgba(30, 30, 35, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 10px;
        color: #e5e7eb;
        font-size: 12px;
        pointer-events: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
      }

      .context-panel.resume-pulse {
        animation: contextPulse 0.7s ease-out;
      }

      .context-panel.park-pulse {
        animation: parkPulse 0.7s ease-out;
      }

      @keyframes contextPulse {
        0% {
          box-shadow: 0 0 0 rgba(59, 130, 246, 0);
        }
        50% {
          box-shadow: 0 0 24px rgba(59, 130, 246, 0.35);
        }
        100% {
          box-shadow: 0 0 0 rgba(59, 130, 246, 0);
        }
      }

      @keyframes parkPulse {
        0% {
          box-shadow: 0 0 0 rgba(34, 197, 94, 0);
        }
        50% {
          box-shadow: 0 0 24px rgba(34, 197, 94, 0.35);
        }
        100% {
          box-shadow: 0 0 0 rgba(34, 197, 94, 0);
        }
      }

      .receipt-screen {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 55;
      }

      .receipt-screen.is-open {
        display: flex;
      }

      .time-echo-screen {
        position: fixed;
        inset: 0;
        background: rgba(8, 8, 12, 0.94);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 70;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
      }

      .time-echo-screen.is-open {
        opacity: 1;
        pointer-events: auto;
      }

      .time-echo-card {
        max-width: 520px;
        padding: 24px 28px;
        border-radius: 16px;
        background: rgba(16, 16, 20, 0.9);
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
        text-align: center;
      }

      .time-echo-label {
        font-size: 11px;
        letter-spacing: 0.2em;
        text-transform: uppercase;
        color: #8b8b95;
        margin-bottom: 14px;
      }

      .time-echo-text {
        font-size: 18px;
        line-height: 1.4;
        color: #f4f4f5;
      }

      .receipt-card {
        width: min(760px, 90vw);
        background: #0b0b0d;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        padding: 28px 32px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        position: relative;
        overflow: hidden;
        animation: receiptIn 0.35s ease-out;
      }

      .receipt-glow {
        position: absolute;
        width: 260px;
        height: 260px;
        background: rgba(59, 130, 246, 0.2);
        border-radius: 999px;
        top: -120px;
        right: -80px;
        filter: blur(60px);
      }

      .receipt-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 18px;
      }

      .receipt-title {
        font-size: 18px;
        font-weight: 700;
        color: #f8fafc;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .receipt-summary {
        font-size: 14px;
        color: #d1d5db;
        margin-bottom: 16px;
      }

      .receipt-metrics {
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 12px;
        margin-bottom: 20px;
      }

      .receipt-metric {
        background: #121214;
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 14px;
        display: grid;
        gap: 6px;
      }

      .receipt-metric-label {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #6b7280;
      }

      .receipt-metric-value {
        font-size: 16px;
        font-weight: 600;
        color: #f9fafb;
      }

      .receipt-diff {
        margin-top: 16px;
        padding: 12px;
        border-radius: 12px;
        background: #101217;
        border: 1px solid rgba(255, 255, 255, 0.06);
        display: grid;
        gap: 8px;
      }

      .receipt-diff-title {
        font-size: 10px;
        letter-spacing: 0.16em;
        text-transform: uppercase;
        color: #94a3b8;
      }

      .receipt-diff-intent {
        font-size: 13px;
        color: #e5e7eb;
      }

      .receipt-diff-files {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .receipt-diff-chip {
        padding: 4px 8px;
        border-radius: 999px;
        background: #151922;
        border: 1px solid rgba(59, 130, 246, 0.15);
        color: #cbd5f5;
        font-size: 11px;
        font-family: "JetBrains Mono", "Cascadia Mono", monospace;
      }

      .receipt-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }

      .receipt-actions button {
        padding: 10px 16px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: #121214;
        color: #e5e7eb;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
      }

      .receipt-actions button.primary {
        background: #2563eb;
        color: #fff;
        border-color: transparent;
        box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
      }

      @keyframes receiptIn {
        from {
          transform: translateY(16px) scale(0.98);
          opacity: 0;
        }
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        .flow-bar-fill,
        .receipt-card,
        .context-panel.resume-pulse {
          animation: none;
        }
      }
    </style>
  </head>
  <body>
    <header class="title-bar">
      <div class="title-left">
        <div class="brand">
          <div class="brand-icon">
            <img
              src="../assets/Vibeflow1X.png"
              srcset="../assets/Vibeflow2X.png 2x, ../assets/Vibeflow4X.png 4x"
              alt="VibeFlow"
            />
          </div>
          <span class="brand-text">VibeFlow</span>
        </div>
        <div id="tab-container" class="tab-container no-drag"></div>
        <button id="vf-tab-add" class="tab-add no-drag" type="button">
          <i class="fa-solid fa-plus"></i>
        </button>
      </div>
      <div class="title-controls no-drag">
        <button id="vf-settings-open" class="title-action" type="button" title="Settings">
          <i class="fa-solid fa-gear"></i>
        </button>
        <button id="vf-history-open" class="title-action" type="button" title="History">
          <i class="fa-solid fa-clock-rotate-left"></i>
        </button>
        <button id="vf-window-minimize" class="win-btn" type="button">
          <i class="fa-solid fa-minus"></i>
        </button>
        <button id="vf-window-maximize" class="win-btn" type="button">
          <i id="vf-window-maximize-icon" class="fa-regular fa-square"></i>
        </button>
        <button id="vf-window-close" class="win-btn close" type="button">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
    </header>

    <main class="workspace">
      <aside id="tool-panel" class="tool-panel">
        <div class="tool-header">
          <span>Files</span>
          <div style="display: flex; align-items: center; gap: 6px;">
          <button id="vf-files-refresh" class="tool-action refresh" type="button" title="Refresh">
            <i class="fa-solid fa-rotate"></i>
          </button>
          <button id="vf-files-toggle" class="tool-action secondary toggle" type="button" title="Collapse">
            <i class="fa-solid fa-chevron-left"></i>
          </button>
          </div>
        </div>
        <div id="vf-file-tree" class="tool-tree"></div>
        <div class="tool-viewer">
          <div id="vf-file-path" class="tool-path">No file selected</div>
          <div id="vf-file-content" class="tool-content">Select a file to preview.</div>
        </div>
      </aside>

      <section id="terminal-container" class="terminal-container">
        <div id="terminal-stack"></div>
        <div id="vf-terminal-scrollbar" class="terminal-scrollbar hidden">
          <div id="vf-terminal-scrollbar-thumb" class="terminal-scrollbar-thumb"></div>
        </div>
        <div id="new-tab-screen" class="new-tab-screen">
          <div class="new-tab-card">
            <button id="vf-welcome-select" type="button">
              <i class="fa-regular fa-folder-open"></i>
              Select Repository
            </button>
            <div class="new-tab-hint">Press Ctrl+O to open</div>
            <div id="vf-recent-wrap" class="recent-wrap">
              <div class="recent-title">Recent workspaces</div>
              <div id="vf-recent-list" class="recent-list"></div>
            </div>
          </div>
        </div>
        <div class="intent-actions" id="vf-terminal-actions">
          <input id="vf-terminal-file" type="file" accept="image/*" style="display: none;" />
          <button id="vf-terminal-attach" class="terminal-attach" type="button" title="Attach image to terminal">
            <i class="fa-regular fa-image"></i>
            Attach
          </button>
          <button id="vf-terminal-jump" class="terminal-jump" type="button" title="Jump to bottom">
            <i class="fa-solid fa-arrow-down"></i>
            Jump
          </button>
          <button id="vf-intent-quick" class="intent-quick" type="button" title="Save intent from terminal">
            <i class="fa-solid fa-bookmark"></i>
            Save intent
          </button>
        </div>
      </section>

      <aside class="context-panel" id="context-panel">
        <div class="context-header">
          <div class="title-container">
            <div class="status-dot"></div>
            <span class="context-title">Live Context</span>
          </div>
          <div class="context-actions">
            <button id="vf-action-echo" class="context-toggle" type="button" title="Send Time Echo">
              <i class="fa-regular fa-hourglass"></i>
            </button>
            <button id="vf-context-toggle" class="context-toggle" type="button">
              <i id="vf-context-icon" class="fa-solid fa-angle-right"></i>
            </button>
          </div>
        </div>

        <div class="panel-content">
          <div class="intent-group">
            <div class="intent-header">
              <span class="intent-label">Active Intent</span>
              <button id="vf-action-intent" class="context-toggle" type="button">
                <i class="fa-regular fa-pen-to-square"></i>
              </button>
            </div>
            <div id="vf-context-intent" class="intent-body">No intent set.</div>
          </div>

          <div class="flow-card">
            <span class="flow-label">Flow State</span>
            <div class="flow-row">
              <span id="vf-context-flow-time" class="flow-time">00:00</span>
              <span class="flow-state">
                <i id="vf-context-flow-icon" class="fa-solid fa-bolt"></i>
                <span id="vf-context-flow-label">Steady</span>
              </span>
            </div>
            <div class="flow-bar">
              <div id="vf-context-flow-bar" class="flow-bar-fill"></div>
            </div>
          </div>

          <div class="thoughts-card">
            <div class="thoughts-header">
              <span class="thoughts-label">Parked Thoughts</span>
              <div style="display: flex; align-items: center; gap: 8px;">
                <kbd style="font-size: 9px; color: #6b7280; border: 1px solid #333; padding: 2px 6px; border-radius: 4px;">Alt+P</kbd>
                <button id="vf-action-thought" class="context-toggle" type="button">
                  <i class="fa-regular fa-note-sticky"></i>
                </button>
              </div>
            </div>
            <ul id="vf-context-thoughts" class="thoughts-list"></ul>
          </div>
        </div>

        <div class="panel-content context-footer">
          <button id="vf-context-copy" type="button">
            <i class="fa-regular fa-copy"></i>
            Copy Context
          </button>
        </div>

        <div id="vf-context-echoes" class="context-echoes">
          <div class="context-echoes-title">Time Echoes</div>
          <div id="vf-echo-list" class="echo-list"></div>
        </div>

        <div class="vertical-label">
          <div class="status-dot"></div>
          <span>Context</span>
        </div>
      </aside>
    </main>

    <div id="vf-voice-overlay" class="voice-overlay" aria-hidden="true">
      <div class="voice-pill">
        <div class="voice-bars">
          <span></span>
          <span></span>
          <span></span>
          <span></span>
        </div>
        <div>Listening...</div>
        <div id="vf-voice-text" class="voice-text"></div>
      </div>
    </div>

    <footer id="command-dock" class="command-dock">
      <div id="vf-chat-log" class="command-log"></div>
      <div class="command-input">
        <div class="cmd-input-wrapper">
          <div class="cmd-prompt">></div>
          <input id="vf-chat-text" type="text" placeholder="Send command to terminal..." />
          <input id="vf-chat-file" type="file" accept="image/*" style="display: none;" />
          <div class="cmd-actions">
            <button id="vf-chat-attach" class="cmd-attach" type="button" title="Attach image (terminal only)" style="position: relative;">
              <i class="fa-regular fa-image"></i>
              <i class="fa-solid fa-terminal attach-terminal-icon"></i>
            </button>
            <button id="vf-chat-agent" class="cmd-agent" type="button" title="Save as intent">
              <i class="fa-solid fa-bookmark"></i>
            </button>
            <div class="cmd-divider"></div>
            <button id="vf-chat-send" type="button">
              <i class="fa-solid fa-arrow-up"></i>
            </button>
          </div>
        </div>
        <div class="command-footer">
          <span>Terminal bridge active</span>
          <div class="command-hints">
            <span>Arrow up: history</span>
            <span>Save: intent</span>
          </div>
          <button id="vf-chat-toggle" class="command-toggle" type="button">
            <i class="fa-solid fa-chevron-down"></i>
            Collapse
          </button>
        </div>
      </div>
      <div class="command-collapsed" id="vf-chat-collapsed">
        <span>Command dock collapsed</span>
        <button id="vf-chat-expand" class="command-toggle" type="button">
          <i class="fa-solid fa-chevron-up"></i>
          Expand
        </button>
      </div>
    </footer>

    <div id="vf-tab-color-menu" class="tab-color-menu" aria-hidden="true">
      <div class="tab-color-title">Tab color</div>
      <div class="tab-color-options" id="vf-tab-color-options"></div>
      <div class="tab-color-clear" id="vf-tab-color-clear">Clear color</div>
    </div>

    <div id="intent-popup" class="overlay-backdrop" style="position: fixed; inset: 0; display: none; align-items: flex-start; justify-content: center; padding-top: 120px; z-index: 50;">
      <div class="popup">
        <div class="popup-header">
          <h3>
            <i id="vf-popup-icon" class="fa-solid fa-bullseye"></i>
            <span id="vf-popup-title">Set Intent</span>
          </h3>
          <kbd style="font-size: 9px; color: #6b7280; border: 1px solid #333; padding: 2px 6px; border-radius: 4px;">Esc</kbd>
        </div>
        <div class="popup-body">
          <input id="vf-input" type="text" placeholder="What are you trying to achieve?" />
        </div>
        <div class="popup-footer">
          <span>Applies to current session</span>
          <span>Press Enter to save</span>
        </div>
      </div>
    </div>

    <div
      id="vf-confirm-overlay"
      class="overlay-backdrop"
      style="position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 55;"
      aria-hidden="true"
    >
      <div class="popup">
        <div class="popup-header">
          <h3 id="vf-confirm-title">Confirm action</h3>
          <span>Permanent change</span>
        </div>
        <div class="popup-body">
          <div id="vf-confirm-message" class="confirm-message">
            This action cannot be undone.
          </div>
        </div>
        <div class="popup-footer">
          <span>This cannot be recovered.</span>
          <div class="confirm-actions">
            <button id="vf-confirm-cancel" class="ghost-button" type="button">Cancel</button>
            <button id="vf-confirm-ok" class="danger-button" type="button">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <div id="resume-screen" class="resume-screen overlay-backdrop">
      <div class="resume-card">
        <div class="resume-header">
          <div class="resume-pill">
            <img src="../assets/Vibeflow2X.png" alt="VibeFlow" />
            VibeFlow Resume
          </div>
          <h1 class="resume-title">Welcome Back</h1>
          <p id="vf-resume-sub" class="resume-sub"></p>
          <div id="vf-resume-repo" class="resume-repo"></div>
          <div id="vf-resume-trace" class="resume-trace" style="display: none;"></div>
        </div>

        <div class="resume-grid">
          <div class="resume-card-box">
            <div class="resume-label">Session Duration</div>
            <div id="vf-resume-duration" class="resume-value">00:00:00</div>
          </div>
          <div class="resume-card-box">
            <div class="resume-label">Flow State</div>
            <div class="resume-flow">
              <i class="fa-solid fa-chart-line"></i>
              <span id="vf-resume-flow">Steady</span>
            </div>
            <div id="vf-resume-flow-detail" class="resume-sub"></div>
          </div>
          <div class="resume-card-box resume-intent">
            <div class="resume-label">Last Active Intent</div>
            <div id="vf-resume-intent" class="resume-intent-text">No intent set.</div>
            <div class="resume-next">
              <i class="fa-regular fa-circle-right"></i>
              <span id="vf-resume-next"></span>
            </div>
          </div>
        </div>

        <div class="resume-actions">
          <button id="vf-resume-new" type="button">
            <i class="fa-solid fa-plus"></i>
            New Session
          </button>
          <button id="vf-copy-context" type="button">
            <i class="fa-regular fa-copy"></i>
            Copy Context
          </button>
          <button id="vf-resume-continue" class="primary" type="button">
            <i class="fa-solid fa-play"></i>
            Continue Session
          </button>
        </div>
      </div>
    </div>

    <div id="time-echo-screen" class="time-echo-screen">
      <div class="time-echo-card">
        <div class="time-echo-label">Earlier, you told yourself</div>
        <div id="vf-time-echo-text" class="time-echo-text"></div>
      </div>
    </div>

    <div id="receipt-screen" class="receipt-screen overlay-backdrop">
      <div class="receipt-card">
        <div class="receipt-glow"></div>
        <div class="receipt-header">
          <div class="receipt-title">
            <i class="fa-solid fa-receipt"></i>
            Session Receipt
          </div>
          <span id="vf-receipt-flow" class="resume-pill" style="font-size: 10px;">
            Steady
          </span>
        </div>
        <div id="vf-receipt-summary" class="receipt-summary"></div>
        <div class="receipt-metrics">
          <div class="receipt-metric">
            <div class="receipt-metric-label">Duration</div>
            <div id="vf-receipt-duration" class="receipt-metric-value">00:00:00</div>
          </div>
          <div class="receipt-metric">
            <div class="receipt-metric-label">Intent Updates</div>
            <div id="vf-receipt-intents" class="receipt-metric-value">0</div>
          </div>
          <div class="receipt-metric">
            <div class="receipt-metric-label">Context Notes</div>
            <div id="vf-receipt-context" class="receipt-metric-value">0</div>
          </div>
        </div>
        <div class="receipt-diff">
          <div class="receipt-diff-title">Context Diff</div>
          <div id="vf-receipt-diff-intent" class="receipt-diff-intent"></div>
          <div id="vf-receipt-diff-files" class="receipt-diff-files"></div>
        </div>
        <div class="receipt-actions">
          <button id="vf-receipt-close" type="button">Close</button>
          <button id="vf-receipt-copy" type="button">
            <i class="fa-regular fa-copy"></i>
            Copy
          </button>
          <button id="vf-receipt-new" class="primary" type="button">
            <i class="fa-solid fa-plus"></i>
            Start New
          </button>
        </div>
      </div>
    </div>

    <script type="module" src="./dist/renderer.js"></script>
  </body>
</html>
